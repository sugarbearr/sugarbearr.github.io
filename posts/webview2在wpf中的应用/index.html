<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>webview2åœ¨wpfä¸­çš„åº”ç”¨ | å”ç’ç‰</title>
<meta name=keywords content="csharp,WPF"><meta name=description content="å¼€å‘ç¯å¢ƒ è¿è¡Œç¯å¢ƒï¼š.Net 6
å¼€å‘ç¯å¢ƒï¼šVisual Studio 2022 17.1.3
æ¡†æ¶è¯­è¨€ï¼šWPF
å®‰è£…WebView2 é€šè¿‡Package Manageræ§åˆ¶å°å®‰è£… Install-Package Microsoft.Web.WebView2 é€šè¿‡NugetåŒ…ç®¡ç†å™¨å®‰è£… !https://s1.ax1x.com/2022/04/09/LinhIe.png
åœ¨çª—ä½“ä¸­æ·»åŠ åå­—ç©ºé—´ï¼š xmlns:wv2=&#34;clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf&#34; å¼•ç”¨WebView2æ§ä»¶ï¼š <wv2:WebView2 x:Name=&#34;webview&#34; Grid.Row=&#34;1&#34; Source=&#34;<https://www.bilibili.com>&#34; /> ä½¿ç”¨WebView2 å…³äºCoreWebView2 ğŸ’¡ Noteï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ§ä»¶ä¸­æ²¡æœ‰è®¾ç½®Sourceå±æ€§ï¼ŒCoreWebView2æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œæ­¤æ—¶éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆå§‹åŒ–CoreWebView2ï¼ŒCoreWebView2åˆå§‹åŒ–æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š
ç¬¬ä¸€ç§ï¼šè°ƒç”¨EnsureCoreWebView2Async()æ–¹æ³• if (webView.CoreWebView2 == null) { await webView.EnsureCoreWebView2Async(); } ç¬¬äºŒç§ï¼šä¸ºSourceå±æ€§èµ‹å€¼ webView.Source = new Url(&#34;<https://www.bilibili.com>&#34;); å¸¸ç”¨è®¾ç½® ä»åˆå§‹åŒ–æ–¹å¼è¯´èµ·ï¼š var env = await CoreWebView2Environment.CreateAsync(); await webView.EnsureCoreWebView2Async(env); è¿™å’Œæˆ‘ä»¬æœ€å¼€å§‹è®²çš„åˆå§‹åŒ–ç›¸æ¯”ï¼Œå¤šä¼ äº†ä¸€ä¸ªenvå˜é‡å‚æ•°æ¥åˆå§‹åŒ–ã€‚è¿™ä¸ªå˜é‡çš„å·¥å‚å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š
public static async Task<CoreWebView2Environment> CreateAsync( string browserExecutableFolder = null, string userDataFolder = null, CoreWebView2EnvironmentOptions options = null) ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°å®ƒå¯ä»¥ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š
browserExecutableFolder userDataFolder options ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é€‰æ‹©Edge Runtimeï¼Œé»˜è®¤ä¸ºé•¿ç»¿ç‰ˆæœ¬ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å›ºå®šç‰ˆæœ¬ï¼Œå½“æˆ‘ä»¬è¦ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ—¶ï¼Œéœ€è¦åšä»¥ä¸‹æ“ä½œï¼š"><meta name=author content="å”ç’ç‰"><link rel=canonical href=https://sugarbearr.github.io/posts/webview2%E5%9C%A8wpf%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/><link crossorigin=anonymous href=/assets/css/stylesheet.4599eadb9eb2ad3d0a8d6827b41a8fda8f2f4af226b63466c09c5fddbc8706b7.css integrity="sha256-RZnq256yrT0KjWgntBqP2o8vSvImtjRmwJxf3byHBrc=" rel="preload stylesheet" as=style><link rel=icon href=https://sugarbearr.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://sugarbearr.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://sugarbearr.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://sugarbearr.github.io/apple-touch-icon.png><link rel=mask-icon href=https://sugarbearr.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="webview2åœ¨wpfä¸­çš„åº”ç”¨"><meta property="og:description" content="å¼€å‘ç¯å¢ƒ è¿è¡Œç¯å¢ƒï¼š.Net 6
å¼€å‘ç¯å¢ƒï¼šVisual Studio 2022 17.1.3
æ¡†æ¶è¯­è¨€ï¼šWPF
å®‰è£…WebView2 é€šè¿‡Package Manageræ§åˆ¶å°å®‰è£… Install-Package Microsoft.Web.WebView2 é€šè¿‡NugetåŒ…ç®¡ç†å™¨å®‰è£… !https://s1.ax1x.com/2022/04/09/LinhIe.png
åœ¨çª—ä½“ä¸­æ·»åŠ åå­—ç©ºé—´ï¼š xmlns:wv2=&#34;clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf&#34; å¼•ç”¨WebView2æ§ä»¶ï¼š <wv2:WebView2 x:Name=&#34;webview&#34; Grid.Row=&#34;1&#34; Source=&#34;<https://www.bilibili.com>&#34; /> ä½¿ç”¨WebView2 å…³äºCoreWebView2 ğŸ’¡ Noteï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ§ä»¶ä¸­æ²¡æœ‰è®¾ç½®Sourceå±æ€§ï¼ŒCoreWebView2æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œæ­¤æ—¶éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆå§‹åŒ–CoreWebView2ï¼ŒCoreWebView2åˆå§‹åŒ–æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š
ç¬¬ä¸€ç§ï¼šè°ƒç”¨EnsureCoreWebView2Async()æ–¹æ³• if (webView.CoreWebView2 == null) { await webView.EnsureCoreWebView2Async(); } ç¬¬äºŒç§ï¼šä¸ºSourceå±æ€§èµ‹å€¼ webView.Source = new Url(&#34;<https://www.bilibili.com>&#34;); å¸¸ç”¨è®¾ç½® ä»åˆå§‹åŒ–æ–¹å¼è¯´èµ·ï¼š var env = await CoreWebView2Environment.CreateAsync(); await webView.EnsureCoreWebView2Async(env); è¿™å’Œæˆ‘ä»¬æœ€å¼€å§‹è®²çš„åˆå§‹åŒ–ç›¸æ¯”ï¼Œå¤šä¼ äº†ä¸€ä¸ªenvå˜é‡å‚æ•°æ¥åˆå§‹åŒ–ã€‚è¿™ä¸ªå˜é‡çš„å·¥å‚å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š
public static async Task<CoreWebView2Environment> CreateAsync( string browserExecutableFolder = null, string userDataFolder = null, CoreWebView2EnvironmentOptions options = null) ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°å®ƒå¯ä»¥ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š
browserExecutableFolder userDataFolder options ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é€‰æ‹©Edge Runtimeï¼Œé»˜è®¤ä¸ºé•¿ç»¿ç‰ˆæœ¬ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å›ºå®šç‰ˆæœ¬ï¼Œå½“æˆ‘ä»¬è¦ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ—¶ï¼Œéœ€è¦åšä»¥ä¸‹æ“ä½œï¼š"><meta property="og:type" content="article"><meta property="og:url" content="https://sugarbearr.github.io/posts/webview2%E5%9C%A8wpf%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-18T22:18:15+08:00"><meta property="article:modified_time" content="2024-01-18T22:18:15+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="webview2åœ¨wpfä¸­çš„åº”ç”¨"><meta name=twitter:description content="å¼€å‘ç¯å¢ƒ è¿è¡Œç¯å¢ƒï¼š.Net 6
å¼€å‘ç¯å¢ƒï¼šVisual Studio 2022 17.1.3
æ¡†æ¶è¯­è¨€ï¼šWPF
å®‰è£…WebView2 é€šè¿‡Package Manageræ§åˆ¶å°å®‰è£… Install-Package Microsoft.Web.WebView2 é€šè¿‡NugetåŒ…ç®¡ç†å™¨å®‰è£… !https://s1.ax1x.com/2022/04/09/LinhIe.png
åœ¨çª—ä½“ä¸­æ·»åŠ åå­—ç©ºé—´ï¼š xmlns:wv2=&#34;clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf&#34; å¼•ç”¨WebView2æ§ä»¶ï¼š <wv2:WebView2 x:Name=&#34;webview&#34; Grid.Row=&#34;1&#34; Source=&#34;<https://www.bilibili.com>&#34; /> ä½¿ç”¨WebView2 å…³äºCoreWebView2 ğŸ’¡ Noteï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ§ä»¶ä¸­æ²¡æœ‰è®¾ç½®Sourceå±æ€§ï¼ŒCoreWebView2æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œæ­¤æ—¶éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆå§‹åŒ–CoreWebView2ï¼ŒCoreWebView2åˆå§‹åŒ–æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š
ç¬¬ä¸€ç§ï¼šè°ƒç”¨EnsureCoreWebView2Async()æ–¹æ³• if (webView.CoreWebView2 == null) { await webView.EnsureCoreWebView2Async(); } ç¬¬äºŒç§ï¼šä¸ºSourceå±æ€§èµ‹å€¼ webView.Source = new Url(&#34;<https://www.bilibili.com>&#34;); å¸¸ç”¨è®¾ç½® ä»åˆå§‹åŒ–æ–¹å¼è¯´èµ·ï¼š var env = await CoreWebView2Environment.CreateAsync(); await webView.EnsureCoreWebView2Async(env); è¿™å’Œæˆ‘ä»¬æœ€å¼€å§‹è®²çš„åˆå§‹åŒ–ç›¸æ¯”ï¼Œå¤šä¼ äº†ä¸€ä¸ªenvå˜é‡å‚æ•°æ¥åˆå§‹åŒ–ã€‚è¿™ä¸ªå˜é‡çš„å·¥å‚å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š
public static async Task<CoreWebView2Environment> CreateAsync( string browserExecutableFolder = null, string userDataFolder = null, CoreWebView2EnvironmentOptions options = null) ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°å®ƒå¯ä»¥ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š
browserExecutableFolder userDataFolder options ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é€‰æ‹©Edge Runtimeï¼Œé»˜è®¤ä¸ºé•¿ç»¿ç‰ˆæœ¬ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å›ºå®šç‰ˆæœ¬ï¼Œå½“æˆ‘ä»¬è¦ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ—¶ï¼Œéœ€è¦åšä»¥ä¸‹æ“ä½œï¼š"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://sugarbearr.github.io/posts/"},{"@type":"ListItem","position":2,"name":"webview2åœ¨wpfä¸­çš„åº”ç”¨","item":"https://sugarbearr.github.io/posts/webview2%E5%9C%A8wpf%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"webview2åœ¨wpfä¸­çš„åº”ç”¨","name":"webview2åœ¨wpfä¸­çš„åº”ç”¨","description":"å¼€å‘ç¯å¢ƒ è¿è¡Œç¯å¢ƒï¼š.Net 6\nå¼€å‘ç¯å¢ƒï¼šVisual Studio 2022 17.1.3\næ¡†æ¶è¯­è¨€ï¼šWPF\nå®‰è£…WebView2 é€šè¿‡Package Manageræ§åˆ¶å°å®‰è£… Install-Package Microsoft.Web.WebView2 é€šè¿‡NugetåŒ…ç®¡ç†å™¨å®‰è£… !https://s1.ax1x.com/2022/04/09/LinhIe.png\nåœ¨çª—ä½“ä¸­æ·»åŠ åå­—ç©ºé—´ï¼š xmlns:wv2=\u0026#34;clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf\u0026#34; å¼•ç”¨WebView2æ§ä»¶ï¼š \u0026lt;wv2:WebView2 x:Name=\u0026#34;webview\u0026#34; Grid.Row=\u0026#34;1\u0026#34; Source=\u0026#34;\u0026lt;https://www.bilibili.com\u0026gt;\u0026#34; /\u0026gt; ä½¿ç”¨WebView2 å…³äºCoreWebView2 ğŸ’¡ Noteï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ§ä»¶ä¸­æ²¡æœ‰è®¾ç½®Sourceå±æ€§ï¼ŒCoreWebView2æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œæ­¤æ—¶éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆå§‹åŒ–CoreWebView2ï¼ŒCoreWebView2åˆå§‹åŒ–æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š\nç¬¬ä¸€ç§ï¼šè°ƒç”¨EnsureCoreWebView2Async()æ–¹æ³• if (webView.CoreWebView2 == null) { await webView.EnsureCoreWebView2Async(); } ç¬¬äºŒç§ï¼šä¸ºSourceå±æ€§èµ‹å€¼ webView.Source = new Url(\u0026#34;\u0026lt;https://www.bilibili.com\u0026gt;\u0026#34;); å¸¸ç”¨è®¾ç½® ä»åˆå§‹åŒ–æ–¹å¼è¯´èµ·ï¼š var env = await CoreWebView2Environment.CreateAsync(); await webView.EnsureCoreWebView2Async(env); è¿™å’Œæˆ‘ä»¬æœ€å¼€å§‹è®²çš„åˆå§‹åŒ–ç›¸æ¯”ï¼Œå¤šä¼ äº†ä¸€ä¸ªenvå˜é‡å‚æ•°æ¥åˆå§‹åŒ–ã€‚è¿™ä¸ªå˜é‡çš„å·¥å‚å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š\npublic static async Task\u0026lt;CoreWebView2Environment\u0026gt; CreateAsync( string browserExecutableFolder = null, string userDataFolder = null, CoreWebView2EnvironmentOptions options = null) ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°å®ƒå¯ä»¥ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š\nbrowserExecutableFolder userDataFolder options ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é€‰æ‹©Edge Runtimeï¼Œé»˜è®¤ä¸ºé•¿ç»¿ç‰ˆæœ¬ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å›ºå®šç‰ˆæœ¬ï¼Œå½“æˆ‘ä»¬è¦ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ—¶ï¼Œéœ€è¦åšä»¥ä¸‹æ“ä½œï¼š","keywords":["csharp","WPF"],"articleBody":"å¼€å‘ç¯å¢ƒ è¿è¡Œç¯å¢ƒï¼š.Net 6\nå¼€å‘ç¯å¢ƒï¼šVisual Studio 2022 17.1.3\næ¡†æ¶è¯­è¨€ï¼šWPF\nå®‰è£…WebView2 é€šè¿‡Package Manageræ§åˆ¶å°å®‰è£… Install-Package Microsoft.Web.WebView2 é€šè¿‡NugetåŒ…ç®¡ç†å™¨å®‰è£… !https://s1.ax1x.com/2022/04/09/LinhIe.png\nåœ¨çª—ä½“ä¸­æ·»åŠ åå­—ç©ºé—´ï¼š xmlns:wv2=\"clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf\" å¼•ç”¨WebView2æ§ä»¶ï¼š ä½¿ç”¨WebView2 å…³äºCoreWebView2 ğŸ’¡ Noteï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ§ä»¶ä¸­æ²¡æœ‰è®¾ç½®Sourceå±æ€§ï¼ŒCoreWebView2æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œæ­¤æ—¶éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆå§‹åŒ–CoreWebView2ï¼ŒCoreWebView2åˆå§‹åŒ–æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š\nç¬¬ä¸€ç§ï¼šè°ƒç”¨EnsureCoreWebView2Async()æ–¹æ³• if (webView.CoreWebView2 == null) { await webView.EnsureCoreWebView2Async(); } ç¬¬äºŒç§ï¼šä¸ºSourceå±æ€§èµ‹å€¼ webView.Source = new Url(\"\"); å¸¸ç”¨è®¾ç½® ä»åˆå§‹åŒ–æ–¹å¼è¯´èµ·ï¼š var env = await CoreWebView2Environment.CreateAsync(); await webView.EnsureCoreWebView2Async(env); è¿™å’Œæˆ‘ä»¬æœ€å¼€å§‹è®²çš„åˆå§‹åŒ–ç›¸æ¯”ï¼Œå¤šä¼ äº†ä¸€ä¸ªenvå˜é‡å‚æ•°æ¥åˆå§‹åŒ–ã€‚è¿™ä¸ªå˜é‡çš„å·¥å‚å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š\npublic static async Task CreateAsync( string browserExecutableFolder = null, string userDataFolder = null, CoreWebView2EnvironmentOptions options = null) ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°å®ƒå¯ä»¥ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š\nbrowserExecutableFolder userDataFolder options ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é€‰æ‹©Edge Runtimeï¼Œé»˜è®¤ä¸ºé•¿ç»¿ç‰ˆæœ¬ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å›ºå®šç‰ˆæœ¬ï¼Œå½“æˆ‘ä»¬è¦ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ—¶ï¼Œéœ€è¦åšä»¥ä¸‹æ“ä½œï¼š\nä¸‹è½½Runtime æ‰“å¼€Edge WebView Runtimeä¸‹è½½é¡µé¢ï¼Œä¸‹è½½ä¸‹è½½å›ºå®šç‰ˆæœ¬ï¼ˆFixed Versionï¼‰ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„ç‰ˆæœ¬å’Œcpuæ¶æ„ã€‚ ä¸‹è½½å®Œæˆåï¼Œä¼šå¾—åˆ°ä¸€ä¸ªå‡ åå…†çš„cabæ–‡ä»¶ï¼Œè§£å‹cabæ–‡ä»¶è‡³æŒ‡å®šæ–‡ä»¶å¤¹ï¼šexpand xxxxx.cab -f:* r:\\webview2 åˆå§‹åŒ–ç¨‹åºçš„æ—¶å€™ï¼ŒæŒ‡å®šè¯¥è·¯å¾„ï¼š if (webView.CoreWebView2 == null) { var env = await CoreWebView2Environment.CreateAsync(@\"R:\\\\WebView2\"); await webView.EnsureCoreWebView2Async(env); } é•¿ç»¿ç‰ˆæœ¬çš„ä¼˜åŠ¿ï¼š å¯ä»¥è‡ªåŠ¨æ›´æ–° æ”¯æŒåœ¨çº¿å’Œç¦»çº¿å®‰è£… æ‰€æœ‰WebView2ç¨‹åºå…±äº«è¿è¡Œæ—¶ï¼ŒèŠ‚çº¦ç£ç›˜ç©ºé—´ å›ºå®šç‰ˆæœ¬çš„ä¼˜åŠ¿ï¼š å¯é˜²æ­¢ç‰ˆæœ¬å‡çº§åˆ°æ¥çš„å…¼å®¹æ€§é—®é¢˜ å¯é˜²æ­¢è¿è¡Œæ—¶è¢«æ„å¤–å¸è½½ å¯å’Œåº”ç”¨ç¨‹åºé›†æˆåœ¨ä¸€èµ· ç¬¬äºŒä¸ªå‚æ•°æ˜¯è‡ªå®šä¹‰ç”¨æˆ·æ•°æ®æ–‡ä»¶å¤¹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒWebView2ç¨‹åºçš„ç”¨æˆ·æ•°æ®æ˜¯æŒ‰ç¨‹åºç‹¬ç«‹å­˜å‚¨çš„ï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç”¨æˆ·æ•°æ®å­˜å‚¨çš„ä½ç½®ã€‚\nvar env = await CoreWebView2Environment.CreateAsync(userDataFolder: @\"R:\\\\WebView2Data\"); await webView.EnsureCoreWebView2Async(env); ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥ç»§ç»­è¡ç”Ÿï¼Œå®ƒçš„æ„é€ å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š\n//é™¤äº†ç¬¬ä¸€ä¸ªadditionalBrowserArgumentså¯ä»¥ç”¨æ¥ä¼ å…¥é¢å¤–çš„å¯åŠ¨å‚æ•°å¤–ï¼Œå…¶å®ƒçš„å‡ ä¸ªå°±ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ public CoreWebView2EnvironmentOptions( string additionalBrowserArguments = null, string language = null, string targetCompatibleBrowserVersion = null, bool allowSingleSignOnUsingOSPrimaryAccount = false) WebView2åˆå§‹åŒ–å®Œæˆåï¼Œè¿˜å¯ä»¥åœ¨webView.CoreWebView2.Settingsä¸­è¿›è¡Œä¸€äº›åŠ¨æ€è®¾ç½®ï¼Œä¸»è¦åŒ…æ‹¬ï¼š\nIsScriptEnabled æ˜¯å¦å¯ç”¨JSè„šæœ¬ IsWebMessageEnabled æ˜¯å¦å¯ç”¨WebMessage AreDefaultScriptDialogsEnabled æ˜¯å¦å¯ç”¨é»˜è®¤çš„å¯¹è¯æ¡† IsStatusBarEnabled æ˜¯å¦æ˜¾ç¤ºçŠ¶æ€æ ï¼Œå…³é—­æ—¶é¼ æ ‡æ‚¬æµ®åœ¨é“¾æ¥ä¸Šæ—¶å³ä¸‹è§’æ²¡æœ‰urlåœ°å€æ˜¾ç¤º AreDevToolsEnabled æ˜¯å¦å¯ç”¨å¼€å‘å·¥å…·ï¼Œ é»˜è®¤ä¸ºtrueï¼Œå…³é—­æ—¶èœå•ä¸­çš„ç›¸åº”é€‰é¡¹ä¹Ÿä¸€èµ·å…³é—­ AreDefaultContextMenusEnabled æ˜¯å¦å¯ç”¨å³é”®èœå• AreHostObjectsAllowed æ˜¯å¦å¯ç”¨è„šæœ¬çš„HostObjectæ³¨å…¥ IsZoomControlEnabled æ˜¯å¦å¯ç”¨ç¼©æ”¾ IsBuiltInErrorPageEnabled æ˜¯å¦å¯ç”¨é»˜è®¤çš„é”™è¯¯å¯¹è¯æ¡† é¡µé¢è·³è½¬ é¡µé¢è·³è½¬å¯ä»¥é€šè¿‡webviewçš„æ¥å£æ¥å®ç°ï¼š\n//ç¬¬ä¸€ç§å®ç°ï¼š webView.Source = new Uri(\"\"); //ç¬¬äºŒç§å®ç°ï¼š webView.NavigateToString(\"hello world\"); è¿™ä¸¤ä¸ªæ–¹æ³•æœ¬èº«åªæ˜¯ä¸€ä¸ªå°è£…ï¼Œå…·ä½“çš„å®ç°åœ¨ç±»å‹ä¸ºCoreWebView2çš„webview.CoreView2å±æ€§é‡Œé¢ï¼ŒåŸºæœ¬ç¤ºä¾‹å¦‚ä¸‹ï¼š\nif (webView.CoreWebView2 == null) { await webView.EnsureCoreWebView2Async(); } webView.CoreWebView2.Navigate(\"\"); æ–°çª—å£æ‰“å¼€é¡µé¢çš„å¤„ç†\nå½“æˆ‘ä»¬è¿›è¡Œé¡µé¢è·³è½¬çš„æ—¶å€™ï¼Œæœ‰çš„æ—¶å€™å›ä½¿ç”¨æ–°çª—å£æ‰“å¼€ï¼ŒWebView2ä¼šå¼¹å‡ºä¸€ä¸ªæœ‰é»˜è®¤æ ·å¼çš„æ–°çª—å£ï¼Œè€Œè¿™å¾€å¾€ä¸æ˜¯æˆ‘ä»¬æ‰€æƒ³è¦çš„æ•ˆæœã€‚è¦é‡è½½è¿™ä¸€è¡Œä¸ºï¼Œå®ç°åœ¨è‡ªå®šä¹‰çš„çª—å£ä¸­æ‰¿è½½æ–°çš„webé¡µé¢ï¼Œéœ€è¦æˆ‘ä»¬å¤„ç†CoreWebView2.NewWindowRequestedäº‹ä»¶ã€‚\nawait webView.EnsureCoreWebView2Async(); webView.CoreWebView2.NewWindowRequested += OnNewWindowRequested; private void OnNewWindowRequested() { var deferral = e.GetDeferral(); e.NewWindow = webView.CoreWebView2; deferral.Complete(); } ç®€å•çš„æ¥è¯´æœ‰å¦‚ä¸‹ä¸‰æ­¥ï¼š\nè·å–Deferralå¯¹è±¡ å°†EventArgs.NewWindowçš„å¼•ç”¨èµ‹ä¸ºæ–°çš„CoreWebViewæ§ä»¶ è°ƒç”¨Deferral.Coimpleteå‡½æ•° è¿™é‡Œæ˜¯å°†æ–°çª—å£åœ¨å½“å‰é¡µé¢ä¸­æ‰“å¼€ï¼Œå®ç°ç±»ä¼¼å¤štabé¡µçš„æµè§ˆå™¨ã€‚åˆ™éœ€è¦æ–°å»ºwebview2æ§ä»¶ï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„ç­‰å¾…åˆå§‹åŒ–å®Œæˆï¼Œå¹¶ä¸”æ–°çš„webview2æ§ä»¶åŒæ ·è¦å¢åŠ NewWindowRequestedçš„å¤„ç†ï¼š\nvar deferral = e.GetDeferral(); //éœ€è¦åŒæ­¥è·å–ï¼Œä¸è¦å¼‚æ­¥ç­‰å¾…åå†è·å– await webView.EnsureCoreWebView2Async(); e.NewWindow = webView.CoreWebView2; deferral.Complete(); æ‰§è¡Œè„šæœ¬ åœ¨å®¿ä¸»ç¨‹åºä¸­æ‰§è¡ŒJavascriptä»£ç  ExecuteScriptAsync()å‡½æ•°ï¼š\nåœ¨JSè„šæœ¬ä¸­çš„å®šä¹‰ï¼š\nfunction alertMsg(val){ alert(val); } å®¿ä¸»è½¯ä»¶ä¸­æ‰§è¡Œ\nawait webView.CoreWebView2.ExecuteScriptAsync(\"alertMsg(\\\\\"Hello,World!\\\\\")\"); AddScriptToExecuteOnDocumentCreatedAsync()å‡½æ•°\nawait webView.CoreWebView2.AddScriptToExecuteOnDocumentCreatedAsync(\"alert('hello world')\"); åå‘æ‰§è¡Œè„šæœ¬ï¼šå°±æ˜¯åœ¨æµè§ˆå™¨é‡Œçš„å‰ç«¯é¡µé¢æ‰§è¡ŒJSè„šæœ¬ï¼Œè°ƒç”¨å®¿ä¸»ç¨‹åºçš„å‡½æ•°ã€‚è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨AddHostObjectToScriptå‡½æ•° å®¿ä¸»è½¯ä»¶ï¼ˆWPFï¼‰å†™æ³•å¦‚ä¸‹ï¼š\n//å®šä¹‰éœ€è¦æ³¨å…¥çš„å¯¹è±¡ [ComVisible(true)] public class Bridge { public string Func(string param) =\u003e \"Example: \" + param; } webView.CoreWebView2.AddHostObjectToScript(\"bridge\", new Bridge()); JSä¸­çš„å†™æ³•å¦‚ä¸‹ï¼š\nconst bridge = chrome.webview.hostObjects.bridge; await bridge.Func(\"Test...\") æ‰§è¡Œç»“æœè¾“å‡ºï¼š\nExample:Test... å®¿ä¸»ç¨‹åºä¸é¡µé¢ä¹‹é—´çš„é€šè®¯ ç›¸è¾ƒäºä¸Šè¿°æ‰€æçš„é€šè¿‡JSå®ç°WebView2å®¿ä¸»ç¨‹åºå’Œå‰ç«¯é¡µé¢è¿›è¡Œé€šä¿¡çš„æ–¹æ³•ï¼Œåœ¨WebView2ä¸­ï¼Œæ›´åŠ é€šç”¨è€Œé«˜æ•ˆçš„æ–¹å¼æ˜¯WebMessageï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ¶ˆæ¯é€šä¿¡ï¼Œå¹¶ä¸”æ”¯æŒåŒå‘é€šä¿¡ã€‚\nWebView2 æ§ä»¶ä¸­çš„ Web å†…å®¹å¯ä»¥ä½¿ç”¨ window.chrome.webview.postMessage å‘å®¿ä¸»ç¨‹åºå‘å¸ƒæ¶ˆæ¯ã€‚å®¿ä¸»ç¨‹åºä½¿ç”¨ä»»ä½•æ³¨å†Œåˆ° WebMessageReceived å§”æ‰˜æ–¹æ³•å¤„ç†æ¶ˆæ¯ã€‚ ä¸»ç¨‹åºä½¿ç”¨ CoreWebView2.PostWebMessageAsString æˆ– CoreWebView2.PostWebMessageAsJSON å°†æ¶ˆæ¯å‘å¸ƒåˆ° WebView2 æ§ä»¶ä¸­çš„ Web å†…å®¹ã€‚è¿™äº›æ¶ˆæ¯ç”±æ·»åŠ åˆ° window.chrome.webview.addEventListener çš„å¤„ç†ç¨‹åºæ•è·ã€‚ å‰ç«¯é¡µé¢å‘é€æ¶ˆæ¯ç»™å®¿ä¸»ç¨‹åºï¼š\nåœ¨WebViewä¸­å®šä¹‰æ¥æ”¶åˆ°æ¶ˆæ¯çš„å¤„ç†å‡½æ•°:\nwebView.WebMessageReceived += (s, e) =\u003e { MessageBox.Show(e.WebMessageAsJson); }; åœ¨å‰ç«¯è„šæœ¬ä¸­å‘é€æ¶ˆæ¯ï¼š\nchrome.webview.postMessage('hello world'); å®¿ä¸»ç¨‹åºå‘æ¶ˆæ¯ç»™å‰ç«¯é¡µé¢ï¼š\nåœ¨å‰ç«¯è„šæœ¬ä¸­éœ€æ³¨å†Œæ¶ˆæ¯çš„å¤„ç†å‡½æ•°ï¼š\nchrome.webview.addEventListener('message', event =\u003e alert(event.data)); åœ¨å®¿ä¸»ç¨‹åºæœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥è¿›è¡Œå‘é€ï¼Œåˆ†åˆ«æ˜¯PostWebMessageAsJson()ä¸PostWebMessageAsString()\nwebView.CoreWebView2.PostWebMessageAsString(\"hello world\"); ç¦ç”¨WebMessageï¼š\nå¦‚æœä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®å°†å…¶ç¦ç”¨ï¼š\nwebView.CoreWebView2.Settings.IsWebMessageEnabled = false; ğŸ’¡ åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å®ç°é¡µé¢åŠ è½½å®Œæˆä¹‹åçš„å›è°ƒæ“ä½œ\nwindow.onload = function () { chrome.webview.postMessage(\"chaet page loaded complete!\"); }; //æ¥æ”¶æ³¨å†Œæ¶ˆæ¯ chart.WebMessageReceived += WebLoaded; public void WebLoaded(object? obj, CoreWebView2WebMessageReceivedEventArgs e) { MessageBox.Show(e.WebMessageAsJson); } Dev Protocol ä½¿ç”¨websocketçš„æ–¹å¼æ¥é©±åŠ¨ var env = await CoreWebView2Environment .CreateAsync(options:new CoreWebView2EnvironmentOptions( \"--remote-debugging-port=9222\")); await webView.EnsureCoreWebView2Async(env); ä½¿ç”¨CoreWebView2å†…ç½®æ–¹æ³• æ‰§è¡Œå‘½ä»¤ï¼šCoreWebView2.CallDevToolsProtocolMethodAsync æ³¨å†Œå›è°ƒï¼šCoreWebView2.GetDevToolsProtocolEventReceiver await webView.CoreWebView2.CallDevToolsProtocolMethodAsync(\"Network.enable\", \"{}\"); var eventRecieiver = webView.CoreWebView2.GetDevToolsProtocolEventReceiver(\"Network.requestWillBeSent\"); eventRecieiver.DevToolsProtocolEventReceived += (s, e) =\u003e { Console.WriteLine(e.ParameterObjectAsJson + \"\\\\n\"); }; å…³äºCallDevToolsProtocolMethodAsync (string methodName, string parametersAsJson)æ–¹æ³•æ–¹æ³•æè¿°ï¼š\nmethodNameï¼šThe full name of the method in the format {domain}.{method} parametersAsJsonï¼šA JSON formatted string containing the parameters for the corresponding method.\nğŸ’¡ chromedevtoolsçš„æ“ä½œå‘½åç©ºé—´ä¸ç›¸å…³æ–¹æ³•æ–‡æ¡£ï¼šdomain\n","wordCount":"389","inLanguage":"en","datePublished":"2024-01-18T22:18:15+08:00","dateModified":"2024-01-18T22:18:15+08:00","author":{"@type":"Person","name":"å”ç’ç‰"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://sugarbearr.github.io/posts/webview2%E5%9C%A8wpf%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/"},"publisher":{"@type":"Organization","name":"å”ç’ç‰","logo":{"@type":"ImageObject","url":"https://sugarbearr.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://sugarbearr.github.io/ accesskey=h title="å”ç’ç‰ (Alt + H)">å”ç’ç‰</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://sugarbearr.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://sugarbearr.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://sugarbearr.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://sugarbearr.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://sugarbearr.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">webview2åœ¨wpfä¸­çš„åº”ç”¨</h1><div class=post-meta><span title='2024-01-18 22:18:15 +0800 CST'>January 18, 2024</span>&nbsp;Â·&nbsp;2 min&nbsp;Â·&nbsp;å”ç’ç‰</div></header><div class=post-content><h1 id=å¼€å‘ç¯å¢ƒ>å¼€å‘<strong>ç¯å¢ƒ</strong><a hidden class=anchor aria-hidden=true href=#å¼€å‘ç¯å¢ƒ>#</a></h1><p>è¿è¡Œç¯å¢ƒï¼š.Net 6</p><p>å¼€å‘ç¯å¢ƒï¼šVisual Studio 2022 17.1.3</p><p>æ¡†æ¶è¯­è¨€ï¼šWPF</p><h1 id=å®‰è£…webview2><strong>å®‰è£…WebView2</strong><a hidden class=anchor aria-hidden=true href=#å®‰è£…webview2>#</a></h1><ol><li>é€šè¿‡Package Manageræ§åˆ¶å°å®‰è£…</li></ol><pre tabindex=0><code>Install-Package Microsoft.Web.WebView2
</code></pre><ol><li>é€šè¿‡NugetåŒ…ç®¡ç†å™¨å®‰è£…</li></ol><p>!https://s1.ax1x.com/2022/04/09/LinhIe.png</p><ol><li>åœ¨çª—ä½“ä¸­æ·»åŠ åå­—ç©ºé—´ï¼š</li></ol><pre tabindex=0><code>xmlns:wv2=&#34;clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf&#34;
</code></pre><ol><li>å¼•ç”¨WebView2æ§ä»¶ï¼š</li></ol><pre tabindex=0><code>&lt;wv2:WebView2 x:Name=&#34;webview&#34; Grid.Row=&#34;1&#34; Source=&#34;&lt;https://www.bilibili.com&gt;&#34; /&gt;
</code></pre><h1 id=ä½¿ç”¨webview2>ä½¿ç”¨WebView2<a hidden class=anchor aria-hidden=true href=#ä½¿ç”¨webview2>#</a></h1><h2 id=å…³äºcorewebview2>å…³äºCoreWebView2<a hidden class=anchor aria-hidden=true href=#å…³äºcorewebview2>#</a></h2><p>ğŸ’¡ Noteï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ§ä»¶ä¸­æ²¡æœ‰è®¾ç½®<code>Source</code>å±æ€§ï¼ŒCoreWebView2æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œæ­¤æ—¶éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆå§‹åŒ–CoreWebView2ï¼ŒCoreWebView2åˆå§‹åŒ–æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p><ul><li><strong>ç¬¬ä¸€ç§ï¼šè°ƒç”¨<code>EnsureCoreWebView2Async()</code>æ–¹æ³•</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>if</span> (webView.CoreWebView2 == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> webView.EnsureCoreWebView2Async();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><strong>ç¬¬äºŒç§ï¼šä¸º<code>Source</code>å±æ€§èµ‹å€¼</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>webView.Source = <span style=color:#66d9ef>new</span> Url(<span style=color:#e6db74>&#34;&lt;https://www.bilibili.com&gt;&#34;</span>);
</span></span></code></pre></div><h2 id=å¸¸ç”¨è®¾ç½®>å¸¸ç”¨è®¾ç½®<a hidden class=anchor aria-hidden=true href=#å¸¸ç”¨è®¾ç½®>#</a></h2><h3 id=ä»åˆå§‹åŒ–æ–¹å¼è¯´èµ·>ä»åˆå§‹åŒ–æ–¹å¼è¯´èµ·ï¼š<a hidden class=anchor aria-hidden=true href=#ä»åˆå§‹åŒ–æ–¹å¼è¯´èµ·>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> env = <span style=color:#66d9ef>await</span> CoreWebView2Environment.CreateAsync();
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> webView.EnsureCoreWebView2Async(env);
</span></span></code></pre></div><p>è¿™å’Œæˆ‘ä»¬æœ€å¼€å§‹è®²çš„åˆå§‹åŒ–ç›¸æ¯”ï¼Œå¤šä¼ äº†ä¸€ä¸ªenvå˜é‡å‚æ•°æ¥åˆå§‹åŒ–ã€‚è¿™ä¸ªå˜é‡çš„å·¥å‚å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>async</span> Task&lt;CoreWebView2Environment&gt; CreateAsync(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>string</span> browserExecutableFolder = <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>string</span> userDataFolder = <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        CoreWebView2EnvironmentOptions options = <span style=color:#66d9ef>null</span>)
</span></span></code></pre></div><p>ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°å®ƒå¯ä»¥ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š</p><ul><li>browserExecutableFolder</li><li>userDataFolder</li><li>options</li></ul><p><strong>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é€‰æ‹©Edge Runtimeï¼Œé»˜è®¤ä¸ºé•¿ç»¿ç‰ˆæœ¬ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å›ºå®šç‰ˆæœ¬ï¼Œå½“æˆ‘ä»¬è¦ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ—¶ï¼Œéœ€è¦åšä»¥ä¸‹æ“ä½œï¼š</strong></p><ul><li>ä¸‹è½½Runtime</li><li>æ‰“å¼€<a href=https://developer.microsoft.com/en-us/microsoft-edge/webview2/>Edge WebView Runtime</a>ä¸‹è½½é¡µé¢ï¼Œä¸‹è½½ä¸‹è½½å›ºå®šç‰ˆæœ¬ï¼ˆFixed Versionï¼‰ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„ç‰ˆæœ¬å’Œcpuæ¶æ„ã€‚</li><li>ä¸‹è½½å®Œæˆåï¼Œä¼šå¾—åˆ°ä¸€ä¸ªå‡ åå…†çš„cabæ–‡ä»¶ï¼Œè§£å‹cabæ–‡ä»¶è‡³æŒ‡å®šæ–‡ä»¶å¤¹ï¼šexpand xxxxx.cab -f:* r:\webview2</li><li>åˆå§‹åŒ–ç¨‹åºçš„æ—¶å€™ï¼ŒæŒ‡å®šè¯¥è·¯å¾„ï¼š</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>if</span> (webView.CoreWebView2 == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>var</span> env = <span style=color:#66d9ef>await</span> CoreWebView2Environment.CreateAsync(<span style=color:#e6db74>@&#34;R:\\WebView2&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>await</span> webView.EnsureCoreWebView2Async(env);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>é•¿ç»¿ç‰ˆæœ¬çš„ä¼˜åŠ¿ï¼š<ol><li>å¯ä»¥è‡ªåŠ¨æ›´æ–°</li><li>æ”¯æŒåœ¨çº¿å’Œç¦»çº¿å®‰è£…</li><li>æ‰€æœ‰WebView2ç¨‹åºå…±äº«è¿è¡Œæ—¶ï¼ŒèŠ‚çº¦ç£ç›˜ç©ºé—´</li></ol></li><li>å›ºå®šç‰ˆæœ¬çš„ä¼˜åŠ¿ï¼š<ol><li>å¯é˜²æ­¢ç‰ˆæœ¬å‡çº§åˆ°æ¥çš„å…¼å®¹æ€§é—®é¢˜</li><li>å¯é˜²æ­¢è¿è¡Œæ—¶è¢«æ„å¤–å¸è½½</li><li>å¯å’Œåº”ç”¨ç¨‹åºé›†æˆåœ¨ä¸€èµ·</li></ol></li></ul><p><strong>ç¬¬äºŒä¸ªå‚æ•°æ˜¯è‡ªå®šä¹‰ç”¨æˆ·æ•°æ®æ–‡ä»¶å¤¹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒWebView2ç¨‹åºçš„ç”¨æˆ·æ•°æ®æ˜¯æŒ‰ç¨‹åºç‹¬ç«‹å­˜å‚¨çš„ï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç”¨æˆ·æ•°æ®å­˜å‚¨çš„ä½ç½®ã€‚</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> env = <span style=color:#66d9ef>await</span> CoreWebView2Environment.CreateAsync(userDataFolder: <span style=color:#e6db74>@&#34;R:\\WebView2Data&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> webView.EnsureCoreWebView2Async(env);
</span></span></code></pre></div><p><strong>ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥ç»§ç»­è¡ç”Ÿï¼Œå®ƒçš„æ„é€ å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>//é™¤äº†ç¬¬ä¸€ä¸ªadditionalBrowserArgumentså¯ä»¥ç”¨æ¥ä¼ å…¥é¢å¤–çš„å¯åŠ¨å‚æ•°å¤–ï¼Œå…¶å®ƒçš„å‡ ä¸ªå°±ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> CoreWebView2EnvironmentOptions(
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>string</span> additionalBrowserArguments = <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>string</span> language = <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>string</span> targetCompatibleBrowserVersion = <span style=color:#66d9ef>null</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>bool</span> allowSingleSignOnUsingOSPrimaryAccount = <span style=color:#66d9ef>false</span>)
</span></span></code></pre></div><p><strong>WebView2åˆå§‹åŒ–å®Œæˆåï¼Œè¿˜å¯ä»¥åœ¨<code>webView.CoreWebView2.Settings</code>ä¸­è¿›è¡Œä¸€äº›åŠ¨æ€è®¾ç½®ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</strong></p><table><thead><tr><th>IsScriptEnabled</th><th>æ˜¯å¦å¯ç”¨JSè„šæœ¬</th></tr></thead><tbody><tr><td>IsWebMessageEnabled</td><td>æ˜¯å¦å¯ç”¨WebMessage</td></tr><tr><td>AreDefaultScriptDialogsEnabled</td><td>æ˜¯å¦å¯ç”¨é»˜è®¤çš„å¯¹è¯æ¡†</td></tr><tr><td>IsStatusBarEnabled</td><td>æ˜¯å¦æ˜¾ç¤ºçŠ¶æ€æ ï¼Œå…³é—­æ—¶é¼ æ ‡æ‚¬æµ®åœ¨é“¾æ¥ä¸Šæ—¶å³ä¸‹è§’æ²¡æœ‰urlåœ°å€æ˜¾ç¤º</td></tr><tr><td>AreDevToolsEnabled</td><td>æ˜¯å¦å¯ç”¨å¼€å‘å·¥å…·ï¼Œ é»˜è®¤ä¸ºtrueï¼Œå…³é—­æ—¶èœå•ä¸­çš„ç›¸åº”é€‰é¡¹ä¹Ÿä¸€èµ·å…³é—­</td></tr><tr><td>AreDefaultContextMenusEnabled</td><td>æ˜¯å¦å¯ç”¨å³é”®èœå•</td></tr><tr><td>AreHostObjectsAllowed</td><td>æ˜¯å¦å¯ç”¨è„šæœ¬çš„HostObjectæ³¨å…¥</td></tr><tr><td>IsZoomControlEnabled</td><td>æ˜¯å¦å¯ç”¨ç¼©æ”¾</td></tr><tr><td>IsBuiltInErrorPageEnabled</td><td>æ˜¯å¦å¯ç”¨é»˜è®¤çš„é”™è¯¯å¯¹è¯æ¡†</td></tr></tbody></table><h2 id=é¡µé¢è·³è½¬>é¡µé¢è·³è½¬<a hidden class=anchor aria-hidden=true href=#é¡µé¢è·³è½¬>#</a></h2><p>é¡µé¢è·³è½¬å¯ä»¥é€šè¿‡webviewçš„æ¥å£æ¥å®ç°ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>//ç¬¬ä¸€ç§å®ç°ï¼š</span>
</span></span><span style=display:flex><span>webView.Source = <span style=color:#66d9ef>new</span> Uri(<span style=color:#e6db74>&#34;&lt;http://www.baidu.com&gt;&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>//ç¬¬äºŒç§å®ç°ï¼š</span>
</span></span><span style=display:flex><span>webView.NavigateToString(<span style=color:#e6db74>&#34;&lt;h1&gt;hello world&lt;/h1&gt;&#34;</span>);
</span></span></code></pre></div><p>è¿™ä¸¤ä¸ªæ–¹æ³•æœ¬èº«åªæ˜¯ä¸€ä¸ªå°è£…ï¼Œå…·ä½“çš„å®ç°åœ¨ç±»å‹ä¸ºCoreWebView2çš„webview.CoreView2å±æ€§é‡Œé¢ï¼ŒåŸºæœ¬ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>if</span> (webView.CoreWebView2 == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>await</span> webView.EnsureCoreWebView2Async();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>webView.CoreWebView2.Navigate(<span style=color:#e6db74>&#34;&lt;https://www.cnblogs.com/tianfang/&gt;&#34;</span>);
</span></span></code></pre></div><p><em><strong>æ–°çª—å£æ‰“å¼€é¡µé¢çš„å¤„ç†</strong></em></p><p>å½“æˆ‘ä»¬è¿›è¡Œé¡µé¢è·³è½¬çš„æ—¶å€™ï¼Œæœ‰çš„æ—¶å€™å›ä½¿ç”¨æ–°çª—å£æ‰“å¼€ï¼ŒWebView2ä¼šå¼¹å‡ºä¸€ä¸ªæœ‰é»˜è®¤æ ·å¼çš„æ–°çª—å£ï¼Œè€Œè¿™å¾€å¾€ä¸æ˜¯æˆ‘ä»¬æ‰€æƒ³è¦çš„æ•ˆæœã€‚è¦é‡è½½è¿™ä¸€è¡Œä¸ºï¼Œå®ç°åœ¨è‡ªå®šä¹‰çš„çª—å£ä¸­æ‰¿è½½æ–°çš„webé¡µé¢ï¼Œéœ€è¦æˆ‘ä»¬å¤„ç†CoreWebView2.NewWindowRequestedäº‹ä»¶ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>await</span> webView.EnsureCoreWebView2Async();
</span></span><span style=display:flex><span>webView.CoreWebView2.NewWindowRequested += OnNewWindowRequested;
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>void</span> OnNewWindowRequested()
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>var</span> deferral = e.GetDeferral();
</span></span><span style=display:flex><span>		e.NewWindow = webView.CoreWebView2;
</span></span><span style=display:flex><span>		deferral.Complete();
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ç®€å•çš„æ¥è¯´æœ‰å¦‚ä¸‹ä¸‰æ­¥ï¼š</p><ol><li>è·å–Deferralå¯¹è±¡</li><li>å°†EventArgs.NewWindowçš„å¼•ç”¨èµ‹ä¸ºæ–°çš„CoreWebViewæ§ä»¶</li><li>è°ƒç”¨Deferral.Coimpleteå‡½æ•°</li></ol><p>è¿™é‡Œæ˜¯å°†æ–°çª—å£åœ¨å½“å‰é¡µé¢ä¸­æ‰“å¼€ï¼Œå®ç°ç±»ä¼¼å¤štabé¡µçš„æµè§ˆå™¨ã€‚åˆ™éœ€è¦æ–°å»ºwebview2æ§ä»¶ï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„ç­‰å¾…åˆå§‹åŒ–å®Œæˆï¼Œå¹¶ä¸”æ–°çš„webview2æ§ä»¶åŒæ ·è¦å¢åŠ NewWindowRequestedçš„å¤„ç†ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> deferral = e.GetDeferral();  <span style=color:#75715e>//éœ€è¦åŒæ­¥è·å–ï¼Œä¸è¦å¼‚æ­¥ç­‰å¾…åå†è·å–</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> webView.EnsureCoreWebView2Async();
</span></span><span style=display:flex><span>e.NewWindow = webView.CoreWebView2;
</span></span><span style=display:flex><span>deferral.Complete();
</span></span></code></pre></div><h2 id=æ‰§è¡Œè„šæœ¬>æ‰§è¡Œè„šæœ¬<a hidden class=anchor aria-hidden=true href=#æ‰§è¡Œè„šæœ¬>#</a></h2><ul><li><strong>åœ¨å®¿ä¸»ç¨‹åºä¸­æ‰§è¡ŒJavascriptä»£ç </strong></li></ul><p><code>ExecuteScriptAsync()</code>å‡½æ•°ï¼š</p><p>åœ¨JSè„šæœ¬ä¸­çš„å®šä¹‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>function alertMsg(val){
</span></span><span style=display:flex><span>  alert(val);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å®¿ä¸»è½¯ä»¶ä¸­æ‰§è¡Œ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>await</span> webView.CoreWebView2.ExecuteScriptAsync(<span style=color:#e6db74>&#34;alertMsg(\\&#34;</span>Hello,World!<span style=color:#960050;background-color:#1e0010>\\</span><span style=color:#e6db74>&#34;)&#34;</span>);
</span></span></code></pre></div><p><code>AddScriptToExecuteOnDocumentCreatedAsync()</code>å‡½æ•°</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>await</span> webView.CoreWebView2.AddScriptToExecuteOnDocumentCreatedAsync(<span style=color:#e6db74>&#34;alert(&#39;hello world&#39;)&#34;</span>);
</span></span></code></pre></div><ul><li><strong>åå‘æ‰§è¡Œè„šæœ¬ï¼šå°±æ˜¯åœ¨æµè§ˆå™¨é‡Œçš„å‰ç«¯é¡µé¢æ‰§è¡ŒJSè„šæœ¬ï¼Œè°ƒç”¨å®¿ä¸»ç¨‹åºçš„å‡½æ•°ã€‚è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨AddHostObjectToScriptå‡½æ•°</strong></li></ul><p>å®¿ä¸»è½¯ä»¶ï¼ˆWPFï¼‰å†™æ³•å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#75715e>//å®šä¹‰éœ€è¦æ³¨å…¥çš„å¯¹è±¡</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>[ComVisible(true)]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Bridge</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string</span> Func(<span style=color:#66d9ef>string</span> param) =&gt; <span style=color:#e6db74>&#34;Example: &#34;</span> + param;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>webView.CoreWebView2.AddHostObjectToScript(<span style=color:#e6db74>&#34;bridge&#34;</span>, <span style=color:#66d9ef>new</span> Bridge());
</span></span></code></pre></div><p>JSä¸­çš„å†™æ³•å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bridge</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>chrome</span>.<span style=color:#a6e22e>webview</span>.<span style=color:#a6e22e>hostObjects</span>.<span style=color:#a6e22e>bridge</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> <span style=color:#a6e22e>bridge</span>.<span style=color:#a6e22e>Func</span>(<span style=color:#e6db74>&#34;Test...&#34;</span>)
</span></span></code></pre></div><p>æ‰§è¡Œç»“æœè¾“å‡ºï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Example:Test...
</span></span></code></pre></div><h2 id=å®¿ä¸»ç¨‹åºä¸é¡µé¢ä¹‹é—´çš„é€šè®¯>å®¿ä¸»ç¨‹åºä¸é¡µé¢ä¹‹é—´çš„é€šè®¯<a hidden class=anchor aria-hidden=true href=#å®¿ä¸»ç¨‹åºä¸é¡µé¢ä¹‹é—´çš„é€šè®¯>#</a></h2><p>ç›¸è¾ƒäºä¸Šè¿°æ‰€æçš„é€šè¿‡JSå®ç°WebView2å®¿ä¸»ç¨‹åºå’Œå‰ç«¯é¡µé¢è¿›è¡Œé€šä¿¡çš„æ–¹æ³•ï¼Œåœ¨WebView2ä¸­ï¼Œæ›´åŠ é€šç”¨è€Œé«˜æ•ˆçš„æ–¹å¼æ˜¯<code>WebMessage</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ¶ˆæ¯é€šä¿¡ï¼Œå¹¶ä¸”æ”¯æŒåŒå‘é€šä¿¡ã€‚</p><ul><li>WebView2 æ§ä»¶ä¸­çš„ Web å†…å®¹å¯ä»¥ä½¿ç”¨ <code>window.chrome.webview.postMessage</code> å‘å®¿ä¸»ç¨‹åºå‘å¸ƒæ¶ˆæ¯ã€‚å®¿ä¸»ç¨‹åºä½¿ç”¨ä»»ä½•æ³¨å†Œåˆ° <code>WebMessageReceived</code> å§”æ‰˜æ–¹æ³•å¤„ç†æ¶ˆæ¯ã€‚</li><li>ä¸»ç¨‹åºä½¿ç”¨ <code>CoreWebView2.PostWebMessageAsString</code> æˆ– <code>CoreWebView2.PostWebMessageAsJSON</code> å°†æ¶ˆæ¯å‘å¸ƒåˆ° WebView2 æ§ä»¶ä¸­çš„ Web å†…å®¹ã€‚è¿™äº›æ¶ˆæ¯ç”±æ·»åŠ åˆ° <code>window.chrome.webview.addEventListener</code> çš„å¤„ç†ç¨‹åºæ•è·ã€‚</li></ul><p><em><strong>å‰ç«¯é¡µé¢å‘é€æ¶ˆæ¯ç»™å®¿ä¸»ç¨‹åºï¼š</strong></em></p><p>åœ¨WebViewä¸­å®šä¹‰æ¥æ”¶åˆ°æ¶ˆæ¯çš„å¤„ç†å‡½æ•°:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>webView.WebMessageReceived += (s, e) =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    MessageBox.Show(e.WebMessageAsJson);
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>åœ¨å‰ç«¯è„šæœ¬ä¸­å‘é€æ¶ˆæ¯ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>chrome.webview.postMessage(<span style=color:#960050;background-color:#1e0010>&#39;</span>hello world<span style=color:#960050;background-color:#1e0010>&#39;</span>);
</span></span></code></pre></div><p><em><strong>å®¿ä¸»ç¨‹åºå‘æ¶ˆæ¯ç»™å‰ç«¯é¡µé¢ï¼š</strong></em></p><p>åœ¨å‰ç«¯è„šæœ¬ä¸­éœ€æ³¨å†Œæ¶ˆæ¯çš„å¤„ç†å‡½æ•°ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>chrome.webview.addEventListener(<span style=color:#960050;background-color:#1e0010>&#39;</span>message<span style=color:#960050;background-color:#1e0010>&#39;</span>, <span style=color:#66d9ef>event</span> =&gt; alert(<span style=color:#66d9ef>event</span>.data));
</span></span></code></pre></div><p>åœ¨å®¿ä¸»ç¨‹åºæœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥è¿›è¡Œå‘é€ï¼Œåˆ†åˆ«æ˜¯<code>PostWebMessageAsJson()</code>ä¸<code>PostWebMessageAsString()</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>webView.CoreWebView2.PostWebMessageAsString(<span style=color:#e6db74>&#34;hello world&#34;</span>);
</span></span></code></pre></div><p><strong>ç¦ç”¨WebMessageï¼š</strong></p><p>å¦‚æœä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®å°†å…¶ç¦ç”¨ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>webView.CoreWebView2.Settings.IsWebMessageEnabled = <span style=color:#66d9ef>false</span>;
</span></span></code></pre></div><p>ğŸ’¡ åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å®ç°é¡µé¢åŠ è½½å®Œæˆä¹‹åçš„å›è°ƒæ“ä½œ</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span>window.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>chrome</span>.<span style=color:#a6e22e>webview</span>.<span style=color:#a6e22e>postMessage</span>(<span style=color:#e6db74>&#34;chaet page loaded complete!&#34;</span>);
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span><span style=color:#75715e>//æ¥æ”¶æ³¨å†Œæ¶ˆæ¯
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>chart</span>.<span style=color:#a6e22e>WebMessageReceived</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>WebLoaded</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>WebLoaded</span>(<span style=color:#a6e22e>object</span><span style=color:#f92672>?</span> <span style=color:#a6e22e>obj</span>, <span style=color:#a6e22e>CoreWebView2WebMessageReceivedEventArgs</span> <span style=color:#a6e22e>e</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>MessageBox</span>.<span style=color:#a6e22e>Show</span>(<span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>WebMessageAsJson</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=dev-protocol>Dev Protocol<a hidden class=anchor aria-hidden=true href=#dev-protocol>#</a></h2><ul><li>ä½¿ç”¨websocketçš„æ–¹å¼æ¥é©±åŠ¨</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>var</span> env = <span style=color:#66d9ef>await</span> CoreWebView2Environment
</span></span><span style=display:flex><span>								.CreateAsync(options:<span style=color:#66d9ef>new</span> CoreWebView2EnvironmentOptions(
</span></span><span style=display:flex><span>                            <span style=color:#e6db74>&#34;--remote-debugging-port=9222&#34;</span>));
</span></span><span style=display:flex><span><span style=color:#66d9ef>await</span> webView.EnsureCoreWebView2Async(env);
</span></span></code></pre></div><ul><li>ä½¿ç”¨CoreWebView2å†…ç½®æ–¹æ³•<ol><li>æ‰§è¡Œå‘½ä»¤ï¼š<code>CoreWebView2.CallDevToolsProtocolMethodAsync</code></li><li>æ³¨å†Œå›è°ƒï¼š<code>CoreWebView2.GetDevToolsProtocolEventReceiver</code></li></ol></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>await</span> webView.CoreWebView2.CallDevToolsProtocolMethodAsync(<span style=color:#e6db74>&#34;Network.enable&#34;</span>, <span style=color:#e6db74>&#34;{}&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> eventRecieiver = webView.CoreWebView2.GetDevToolsProtocolEventReceiver(<span style=color:#e6db74>&#34;Network.requestWillBeSent&#34;</span>);
</span></span><span style=display:flex><span>eventRecieiver.DevToolsProtocolEventReceived += (s, e) =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    Console.WriteLine(e.ParameterObjectAsJson + <span style=color:#e6db74>&#34;\\n&#34;</span>);
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><p>å…³äº<code>CallDevToolsProtocolMethodAsync (string methodName, string parametersAsJson)</code>æ–¹æ³•æ–¹æ³•æè¿°ï¼š</p><blockquote><p>methodNameï¼šThe full name of the method in the format <code>{domain}.{method}</code> parametersAsJsonï¼šA JSON formatted string containing the parameters for the corresponding method.</p></blockquote><p>ğŸ’¡ chromedevtoolsçš„æ“ä½œå‘½åç©ºé—´ä¸ç›¸å…³æ–¹æ³•æ–‡æ¡£ï¼š<a href=https://chromedevtools.github.io/devtools-protocol/tot/Accessibility/>domain</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://sugarbearr.github.io/tags/csharp/>csharp</a></li><li><a href=https://sugarbearr.github.io/tags/wpf/>WPF</a></li></ul><nav class=paginav><a class=next href=https://sugarbearr.github.io/posts/rx.net/><span class=title>Next Â»</span><br><span>Rx.NET</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://sugarbearr.github.io/>å”ç’ç‰</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>