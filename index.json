[{"content":"å¼€å‘ç¯å¢ƒ è¿è¡Œç¯å¢ƒï¼š.Net 6\nå¼€å‘ç¯å¢ƒï¼šVisual Studio 2022 17.1.3\næ¡†æ¶è¯­è¨€ï¼šWPF\nå®‰è£…WebView2 é€šè¿‡Package Manageræ§åˆ¶å°å®‰è£… Install-Package Microsoft.Web.WebView2 é€šè¿‡NugetåŒ…ç®¡ç†å™¨å®‰è£… !https://s1.ax1x.com/2022/04/09/LinhIe.png\nåœ¨çª—ä½“ä¸­æ·»åŠ åå­—ç©ºé—´ï¼š xmlns:wv2=\u0026#34;clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf\u0026#34; å¼•ç”¨WebView2æ§ä»¶ï¼š \u0026lt;wv2:WebView2 x:Name=\u0026#34;webview\u0026#34; Grid.Row=\u0026#34;1\u0026#34; Source=\u0026#34;\u0026lt;https://www.bilibili.com\u0026gt;\u0026#34; /\u0026gt; ä½¿ç”¨WebView2 å…³äºCoreWebView2 ğŸ’¡ Noteï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ§ä»¶ä¸­æ²¡æœ‰è®¾ç½®Sourceå±æ€§ï¼ŒCoreWebView2æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œæ­¤æ—¶éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆå§‹åŒ–CoreWebView2ï¼ŒCoreWebView2åˆå§‹åŒ–æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š\nç¬¬ä¸€ç§ï¼šè°ƒç”¨EnsureCoreWebView2Async()æ–¹æ³• if (webView.CoreWebView2 == null) { await webView.EnsureCoreWebView2Async(); } ç¬¬äºŒç§ï¼šä¸ºSourceå±æ€§èµ‹å€¼ webView.Source = new Url(\u0026#34;\u0026lt;https://www.bilibili.com\u0026gt;\u0026#34;); å¸¸ç”¨è®¾ç½® ä»åˆå§‹åŒ–æ–¹å¼è¯´èµ·ï¼š var env = await CoreWebView2Environment.CreateAsync(); await webView.EnsureCoreWebView2Async(env); è¿™å’Œæˆ‘ä»¬æœ€å¼€å§‹è®²çš„åˆå§‹åŒ–ç›¸æ¯”ï¼Œå¤šä¼ äº†ä¸€ä¸ªenvå˜é‡å‚æ•°æ¥åˆå§‹åŒ–ã€‚è¿™ä¸ªå˜é‡çš„å·¥å‚å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š\npublic static async Task\u0026lt;CoreWebView2Environment\u0026gt; CreateAsync( string browserExecutableFolder = null, string userDataFolder = null, CoreWebView2EnvironmentOptions options = null) ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°å®ƒå¯ä»¥ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š\nbrowserExecutableFolder userDataFolder options ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é€‰æ‹©Edge Runtimeï¼Œé»˜è®¤ä¸ºé•¿ç»¿ç‰ˆæœ¬ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å›ºå®šç‰ˆæœ¬ï¼Œå½“æˆ‘ä»¬è¦ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ—¶ï¼Œéœ€è¦åšä»¥ä¸‹æ“ä½œï¼š\nä¸‹è½½Runtime æ‰“å¼€Edge WebView Runtimeä¸‹è½½é¡µé¢ï¼Œä¸‹è½½ä¸‹è½½å›ºå®šç‰ˆæœ¬ï¼ˆFixed Versionï¼‰ï¼Œå¯ä»¥é€‰æ‹©ä¸åŒçš„ç‰ˆæœ¬å’Œcpuæ¶æ„ã€‚ ä¸‹è½½å®Œæˆåï¼Œä¼šå¾—åˆ°ä¸€ä¸ªå‡ åå…†çš„cabæ–‡ä»¶ï¼Œè§£å‹cabæ–‡ä»¶è‡³æŒ‡å®šæ–‡ä»¶å¤¹ï¼šexpand xxxxx.cab -f:* r:\\webview2 åˆå§‹åŒ–ç¨‹åºçš„æ—¶å€™ï¼ŒæŒ‡å®šè¯¥è·¯å¾„ï¼š if (webView.CoreWebView2 == null) { var env = await CoreWebView2Environment.CreateAsync(@\u0026#34;R:\\\\WebView2\u0026#34;); await webView.EnsureCoreWebView2Async(env); } é•¿ç»¿ç‰ˆæœ¬çš„ä¼˜åŠ¿ï¼š å¯ä»¥è‡ªåŠ¨æ›´æ–° æ”¯æŒåœ¨çº¿å’Œç¦»çº¿å®‰è£… æ‰€æœ‰WebView2ç¨‹åºå…±äº«è¿è¡Œæ—¶ï¼ŒèŠ‚çº¦ç£ç›˜ç©ºé—´ å›ºå®šç‰ˆæœ¬çš„ä¼˜åŠ¿ï¼š å¯é˜²æ­¢ç‰ˆæœ¬å‡çº§åˆ°æ¥çš„å…¼å®¹æ€§é—®é¢˜ å¯é˜²æ­¢è¿è¡Œæ—¶è¢«æ„å¤–å¸è½½ å¯å’Œåº”ç”¨ç¨‹åºé›†æˆåœ¨ä¸€èµ· ç¬¬äºŒä¸ªå‚æ•°æ˜¯è‡ªå®šä¹‰ç”¨æˆ·æ•°æ®æ–‡ä»¶å¤¹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒWebView2ç¨‹åºçš„ç”¨æˆ·æ•°æ®æ˜¯æŒ‰ç¨‹åºç‹¬ç«‹å­˜å‚¨çš„ï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰ç”¨æˆ·æ•°æ®å­˜å‚¨çš„ä½ç½®ã€‚\nvar env = await CoreWebView2Environment.CreateAsync(userDataFolder: @\u0026#34;R:\\\\WebView2Data\u0026#34;); await webView.EnsureCoreWebView2Async(env); ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥ç»§ç»­è¡ç”Ÿï¼Œå®ƒçš„æ„é€ å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š\n//é™¤äº†ç¬¬ä¸€ä¸ªadditionalBrowserArgumentså¯ä»¥ç”¨æ¥ä¼ å…¥é¢å¤–çš„å¯åŠ¨å‚æ•°å¤–ï¼Œå…¶å®ƒçš„å‡ ä¸ªå°±ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨ public CoreWebView2EnvironmentOptions( string additionalBrowserArguments = null, string language = null, string targetCompatibleBrowserVersion = null, bool allowSingleSignOnUsingOSPrimaryAccount = false) WebView2åˆå§‹åŒ–å®Œæˆåï¼Œè¿˜å¯ä»¥åœ¨webView.CoreWebView2.Settingsä¸­è¿›è¡Œä¸€äº›åŠ¨æ€è®¾ç½®ï¼Œä¸»è¦åŒ…æ‹¬ï¼š\nIsScriptEnabled æ˜¯å¦å¯ç”¨JSè„šæœ¬ IsWebMessageEnabled æ˜¯å¦å¯ç”¨WebMessage AreDefaultScriptDialogsEnabled æ˜¯å¦å¯ç”¨é»˜è®¤çš„å¯¹è¯æ¡† IsStatusBarEnabled æ˜¯å¦æ˜¾ç¤ºçŠ¶æ€æ ï¼Œå…³é—­æ—¶é¼ æ ‡æ‚¬æµ®åœ¨é“¾æ¥ä¸Šæ—¶å³ä¸‹è§’æ²¡æœ‰urlåœ°å€æ˜¾ç¤º AreDevToolsEnabled æ˜¯å¦å¯ç”¨å¼€å‘å·¥å…·ï¼Œ é»˜è®¤ä¸ºtrueï¼Œå…³é—­æ—¶èœå•ä¸­çš„ç›¸åº”é€‰é¡¹ä¹Ÿä¸€èµ·å…³é—­ AreDefaultContextMenusEnabled æ˜¯å¦å¯ç”¨å³é”®èœå• AreHostObjectsAllowed æ˜¯å¦å¯ç”¨è„šæœ¬çš„HostObjectæ³¨å…¥ IsZoomControlEnabled æ˜¯å¦å¯ç”¨ç¼©æ”¾ IsBuiltInErrorPageEnabled æ˜¯å¦å¯ç”¨é»˜è®¤çš„é”™è¯¯å¯¹è¯æ¡† é¡µé¢è·³è½¬ é¡µé¢è·³è½¬å¯ä»¥é€šè¿‡webviewçš„æ¥å£æ¥å®ç°ï¼š\n//ç¬¬ä¸€ç§å®ç°ï¼š webView.Source = new Uri(\u0026#34;\u0026lt;http://www.baidu.com\u0026gt;\u0026#34;); //ç¬¬äºŒç§å®ç°ï¼š webView.NavigateToString(\u0026#34;\u0026lt;h1\u0026gt;hello world\u0026lt;/h1\u0026gt;\u0026#34;); è¿™ä¸¤ä¸ªæ–¹æ³•æœ¬èº«åªæ˜¯ä¸€ä¸ªå°è£…ï¼Œå…·ä½“çš„å®ç°åœ¨ç±»å‹ä¸ºCoreWebView2çš„webview.CoreView2å±æ€§é‡Œé¢ï¼ŒåŸºæœ¬ç¤ºä¾‹å¦‚ä¸‹ï¼š\nif (webView.CoreWebView2 == null) { await webView.EnsureCoreWebView2Async(); } webView.CoreWebView2.Navigate(\u0026#34;\u0026lt;https://www.cnblogs.com/tianfang/\u0026gt;\u0026#34;); æ–°çª—å£æ‰“å¼€é¡µé¢çš„å¤„ç†\nå½“æˆ‘ä»¬è¿›è¡Œé¡µé¢è·³è½¬çš„æ—¶å€™ï¼Œæœ‰çš„æ—¶å€™å›ä½¿ç”¨æ–°çª—å£æ‰“å¼€ï¼ŒWebView2ä¼šå¼¹å‡ºä¸€ä¸ªæœ‰é»˜è®¤æ ·å¼çš„æ–°çª—å£ï¼Œè€Œè¿™å¾€å¾€ä¸æ˜¯æˆ‘ä»¬æ‰€æƒ³è¦çš„æ•ˆæœã€‚è¦é‡è½½è¿™ä¸€è¡Œä¸ºï¼Œå®ç°åœ¨è‡ªå®šä¹‰çš„çª—å£ä¸­æ‰¿è½½æ–°çš„webé¡µé¢ï¼Œéœ€è¦æˆ‘ä»¬å¤„ç†CoreWebView2.NewWindowRequestedäº‹ä»¶ã€‚\nawait webView.EnsureCoreWebView2Async(); webView.CoreWebView2.NewWindowRequested += OnNewWindowRequested; private void OnNewWindowRequested() { var deferral = e.GetDeferral(); e.NewWindow = webView.CoreWebView2; deferral.Complete(); } ç®€å•çš„æ¥è¯´æœ‰å¦‚ä¸‹ä¸‰æ­¥ï¼š\nè·å–Deferralå¯¹è±¡ å°†EventArgs.NewWindowçš„å¼•ç”¨èµ‹ä¸ºæ–°çš„CoreWebViewæ§ä»¶ è°ƒç”¨Deferral.Coimpleteå‡½æ•° è¿™é‡Œæ˜¯å°†æ–°çª—å£åœ¨å½“å‰é¡µé¢ä¸­æ‰“å¼€ï¼Œå®ç°ç±»ä¼¼å¤štabé¡µçš„æµè§ˆå™¨ã€‚åˆ™éœ€è¦æ–°å»ºwebview2æ§ä»¶ï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„ç­‰å¾…åˆå§‹åŒ–å®Œæˆï¼Œå¹¶ä¸”æ–°çš„webview2æ§ä»¶åŒæ ·è¦å¢åŠ NewWindowRequestedçš„å¤„ç†ï¼š\nvar deferral = e.GetDeferral(); //éœ€è¦åŒæ­¥è·å–ï¼Œä¸è¦å¼‚æ­¥ç­‰å¾…åå†è·å– await webView.EnsureCoreWebView2Async(); e.NewWindow = webView.CoreWebView2; deferral.Complete(); æ‰§è¡Œè„šæœ¬ åœ¨å®¿ä¸»ç¨‹åºä¸­æ‰§è¡ŒJavascriptä»£ç  ExecuteScriptAsync()å‡½æ•°ï¼š\nåœ¨JSè„šæœ¬ä¸­çš„å®šä¹‰ï¼š\nfunction alertMsg(val){ alert(val); } å®¿ä¸»è½¯ä»¶ä¸­æ‰§è¡Œ\nawait webView.CoreWebView2.ExecuteScriptAsync(\u0026#34;alertMsg(\\\\\u0026#34;Hello,World!\\\\\u0026#34;)\u0026#34;); AddScriptToExecuteOnDocumentCreatedAsync()å‡½æ•°\nawait webView.CoreWebView2.AddScriptToExecuteOnDocumentCreatedAsync(\u0026#34;alert(\u0026#39;hello world\u0026#39;)\u0026#34;); åå‘æ‰§è¡Œè„šæœ¬ï¼šå°±æ˜¯åœ¨æµè§ˆå™¨é‡Œçš„å‰ç«¯é¡µé¢æ‰§è¡ŒJSè„šæœ¬ï¼Œè°ƒç”¨å®¿ä¸»ç¨‹åºçš„å‡½æ•°ã€‚è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨AddHostObjectToScriptå‡½æ•° å®¿ä¸»è½¯ä»¶ï¼ˆWPFï¼‰å†™æ³•å¦‚ä¸‹ï¼š\n//å®šä¹‰éœ€è¦æ³¨å…¥çš„å¯¹è±¡ [ComVisible(true)] public class Bridge { public string Func(string param) =\u0026gt; \u0026#34;Example: \u0026#34; + param; } webView.CoreWebView2.AddHostObjectToScript(\u0026#34;bridge\u0026#34;, new Bridge()); JSä¸­çš„å†™æ³•å¦‚ä¸‹ï¼š\nconst bridge = chrome.webview.hostObjects.bridge; await bridge.Func(\u0026#34;Test...\u0026#34;) æ‰§è¡Œç»“æœè¾“å‡ºï¼š\nExample:Test... å®¿ä¸»ç¨‹åºä¸é¡µé¢ä¹‹é—´çš„é€šè®¯ ç›¸è¾ƒäºä¸Šè¿°æ‰€æçš„é€šè¿‡JSå®ç°WebView2å®¿ä¸»ç¨‹åºå’Œå‰ç«¯é¡µé¢è¿›è¡Œé€šä¿¡çš„æ–¹æ³•ï¼Œåœ¨WebView2ä¸­ï¼Œæ›´åŠ é€šç”¨è€Œé«˜æ•ˆçš„æ–¹å¼æ˜¯WebMessageï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ¶ˆæ¯é€šä¿¡ï¼Œå¹¶ä¸”æ”¯æŒåŒå‘é€šä¿¡ã€‚\nWebView2 æ§ä»¶ä¸­çš„ Web å†…å®¹å¯ä»¥ä½¿ç”¨ window.chrome.webview.postMessage å‘å®¿ä¸»ç¨‹åºå‘å¸ƒæ¶ˆæ¯ã€‚å®¿ä¸»ç¨‹åºä½¿ç”¨ä»»ä½•æ³¨å†Œåˆ° WebMessageReceived å§”æ‰˜æ–¹æ³•å¤„ç†æ¶ˆæ¯ã€‚ ä¸»ç¨‹åºä½¿ç”¨ CoreWebView2.PostWebMessageAsString æˆ– CoreWebView2.PostWebMessageAsJSON å°†æ¶ˆæ¯å‘å¸ƒåˆ° WebView2 æ§ä»¶ä¸­çš„ Web å†…å®¹ã€‚è¿™äº›æ¶ˆæ¯ç”±æ·»åŠ åˆ° window.chrome.webview.addEventListener çš„å¤„ç†ç¨‹åºæ•è·ã€‚ å‰ç«¯é¡µé¢å‘é€æ¶ˆæ¯ç»™å®¿ä¸»ç¨‹åºï¼š\nåœ¨WebViewä¸­å®šä¹‰æ¥æ”¶åˆ°æ¶ˆæ¯çš„å¤„ç†å‡½æ•°:\nwebView.WebMessageReceived += (s, e) =\u0026gt; { MessageBox.Show(e.WebMessageAsJson); }; åœ¨å‰ç«¯è„šæœ¬ä¸­å‘é€æ¶ˆæ¯ï¼š\nchrome.webview.postMessage(\u0026#39;hello world\u0026#39;); å®¿ä¸»ç¨‹åºå‘æ¶ˆæ¯ç»™å‰ç«¯é¡µé¢ï¼š\nåœ¨å‰ç«¯è„šæœ¬ä¸­éœ€æ³¨å†Œæ¶ˆæ¯çš„å¤„ç†å‡½æ•°ï¼š\nchrome.webview.addEventListener(\u0026#39;message\u0026#39;, event =\u0026gt; alert(event.data)); åœ¨å®¿ä¸»ç¨‹åºæœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥è¿›è¡Œå‘é€ï¼Œåˆ†åˆ«æ˜¯PostWebMessageAsJson()ä¸PostWebMessageAsString()\nwebView.CoreWebView2.PostWebMessageAsString(\u0026#34;hello world\u0026#34;); ç¦ç”¨WebMessageï¼š\nå¦‚æœä¸ºäº†å®‰å…¨èµ·è§ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®å°†å…¶ç¦ç”¨ï¼š\nwebView.CoreWebView2.Settings.IsWebMessageEnabled = false; ğŸ’¡ åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥å®ç°é¡µé¢åŠ è½½å®Œæˆä¹‹åçš„å›è°ƒæ“ä½œ\nwindow.onload = function () { chrome.webview.postMessage(\u0026#34;chaet page loaded complete!\u0026#34;); }; //æ¥æ”¶æ³¨å†Œæ¶ˆæ¯ chart.WebMessageReceived += WebLoaded; public void WebLoaded(object? obj, CoreWebView2WebMessageReceivedEventArgs e) { MessageBox.Show(e.WebMessageAsJson); } Dev Protocol ä½¿ç”¨websocketçš„æ–¹å¼æ¥é©±åŠ¨ var env = await CoreWebView2Environment .CreateAsync(options:new CoreWebView2EnvironmentOptions( \u0026#34;--remote-debugging-port=9222\u0026#34;)); await webView.EnsureCoreWebView2Async(env); ä½¿ç”¨CoreWebView2å†…ç½®æ–¹æ³• æ‰§è¡Œå‘½ä»¤ï¼šCoreWebView2.CallDevToolsProtocolMethodAsync æ³¨å†Œå›è°ƒï¼šCoreWebView2.GetDevToolsProtocolEventReceiver await webView.CoreWebView2.CallDevToolsProtocolMethodAsync(\u0026#34;Network.enable\u0026#34;, \u0026#34;{}\u0026#34;); var eventRecieiver = webView.CoreWebView2.GetDevToolsProtocolEventReceiver(\u0026#34;Network.requestWillBeSent\u0026#34;); eventRecieiver.DevToolsProtocolEventReceived += (s, e) =\u0026gt; { Console.WriteLine(e.ParameterObjectAsJson + \u0026#34;\\\\n\u0026#34;); }; å…³äºCallDevToolsProtocolMethodAsync (string methodName, string parametersAsJson)æ–¹æ³•æ–¹æ³•æè¿°ï¼š\nmethodNameï¼šThe full name of the method in the format {domain}.{method} parametersAsJsonï¼šA JSON formatted string containing the parameters for the corresponding method.\nğŸ’¡ chromedevtoolsçš„æ“ä½œå‘½åç©ºé—´ä¸ç›¸å…³æ–¹æ³•æ–‡æ¡£ï¼šdomain\n","permalink":"https://sugarbearr.github.io/posts/webview2%E5%9C%A8wpf%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/","summary":"å¼€å‘ç¯å¢ƒ è¿è¡Œç¯å¢ƒï¼š.Net 6\nå¼€å‘ç¯å¢ƒï¼šVisual Studio 2022 17.1.3\næ¡†æ¶è¯­è¨€ï¼šWPF\nå®‰è£…WebView2 é€šè¿‡Package Manageræ§åˆ¶å°å®‰è£… Install-Package Microsoft.Web.WebView2 é€šè¿‡NugetåŒ…ç®¡ç†å™¨å®‰è£… !https://s1.ax1x.com/2022/04/09/LinhIe.png\nåœ¨çª—ä½“ä¸­æ·»åŠ åå­—ç©ºé—´ï¼š xmlns:wv2=\u0026#34;clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf\u0026#34; å¼•ç”¨WebView2æ§ä»¶ï¼š \u0026lt;wv2:WebView2 x:Name=\u0026#34;webview\u0026#34; Grid.Row=\u0026#34;1\u0026#34; Source=\u0026#34;\u0026lt;https://www.bilibili.com\u0026gt;\u0026#34; /\u0026gt; ä½¿ç”¨WebView2 å…³äºCoreWebView2 ğŸ’¡ Noteï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ§ä»¶ä¸­æ²¡æœ‰è®¾ç½®Sourceå±æ€§ï¼ŒCoreWebView2æ˜¯æ²¡æœ‰åˆå§‹åŒ–çš„ï¼Œæ­¤æ—¶éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨åˆå§‹åŒ–CoreWebView2ï¼ŒCoreWebView2åˆå§‹åŒ–æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š\nç¬¬ä¸€ç§ï¼šè°ƒç”¨EnsureCoreWebView2Async()æ–¹æ³• if (webView.CoreWebView2 == null) { await webView.EnsureCoreWebView2Async(); } ç¬¬äºŒç§ï¼šä¸ºSourceå±æ€§èµ‹å€¼ webView.Source = new Url(\u0026#34;\u0026lt;https://www.bilibili.com\u0026gt;\u0026#34;); å¸¸ç”¨è®¾ç½® ä»åˆå§‹åŒ–æ–¹å¼è¯´èµ·ï¼š var env = await CoreWebView2Environment.CreateAsync(); await webView.EnsureCoreWebView2Async(env); è¿™å’Œæˆ‘ä»¬æœ€å¼€å§‹è®²çš„åˆå§‹åŒ–ç›¸æ¯”ï¼Œå¤šä¼ äº†ä¸€ä¸ªenvå˜é‡å‚æ•°æ¥åˆå§‹åŒ–ã€‚è¿™ä¸ªå˜é‡çš„å·¥å‚å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š\npublic static async Task\u0026lt;CoreWebView2Environment\u0026gt; CreateAsync( string browserExecutableFolder = null, string userDataFolder = null, CoreWebView2EnvironmentOptions options = null) ä»ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå·¥å‚å‡½æ•°å®ƒå¯ä»¥ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š\nbrowserExecutableFolder userDataFolder options ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é€‰æ‹©Edge Runtimeï¼Œé»˜è®¤ä¸ºé•¿ç»¿ç‰ˆæœ¬ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©å›ºå®šç‰ˆæœ¬ï¼Œå½“æˆ‘ä»¬è¦ä½¿ç”¨å›ºå®šç‰ˆæœ¬æ—¶ï¼Œéœ€è¦åšä»¥ä¸‹æ“ä½œï¼š","title":"webview2åœ¨wpfä¸­çš„åº”ç”¨"},{"content":"ç¼–ç¨‹èŒƒå¼ï¼š ç¼–ç¨‹èŒƒå¼åˆ†ä¸ºå‘½ä»¤å¼ç¼–ç¨‹ã€å£°æ˜å¼ç¼–ç¨‹ã€å‡½æ•°å¼ç¼–ç¨‹å’Œå“åº”å¼ç¼–ç¨‹ã€‚\nå‘½ä»¤å¼ç¼–ç¨‹ï¼š å‘½ä»¤å¼ç¼–ç¨‹çš„ä¸»è¦æ€æƒ³æ˜¯å…³æ³¨è®¡ç®—æœºæ‰§è¡Œçš„æ­¥éª¤ï¼Œå³ä¸€æ­¥ä¸€æ­¥å‘Šè¯‰è®¡ç®—æœºå…ˆåšä»€ä¹ˆå†åšä»€ä¹ˆã€‚ //1. å£°æ˜å˜é‡ List\u0026lt;int\u0026gt; results = new List\u0026lt;int\u0026gt;(); //2. å¾ªç¯å˜é‡ foreach(var num in Enumerable.Range(1,10)) { //3. æ·»åŠ æ¡ä»¶ if (num \u0026gt; 5) { //4. æ·»åŠ å¤„ç†é€»è¾‘ results.Add(num); Console.WriteLine(num); } } å£°æ˜å¼ç¼–ç¨‹ï¼š å£°æ˜å¼ç¼–ç¨‹æ˜¯ä»¥æ•°æ®ç»“æ„çš„å½¢å¼æ¥è¡¨è¾¾ç¨‹åºæ‰§è¡Œçš„é€»è¾‘ã€‚å®ƒçš„ä¸»è¦æ€æƒ³æ˜¯å‘Šè¯‰è®¡ç®—æœºåº”è¯¥åšä»€ä¹ˆï¼Œä½†ä¸æŒ‡å®šå…·ä½“è¦æ€ä¹ˆåšã€‚ var nums = from num in Enumerable.Range(1,10) where num \u0026gt; 5 select num å‡½æ•°å¼ç¼–ç¨‹ï¼š ä¸»è¦æ€æƒ³æ˜¯æŠŠè¿ç®—è¿‡ç¨‹å°½é‡å†™æˆä¸€ç³»åˆ—åµŒå¥—çš„å‡½æ•°è°ƒç”¨ã€‚ Enumerable.Range(1, 10).Where(num =\u0026gt; num \u0026gt; 5).ToList().ForEach(Console.WriteLine); å“åº”å¼ç¼–ç¨‹ï¼š å“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ç§é¢å‘æ•°æ®æµå’Œå˜åŒ–ä¼ æ’­çš„ç¼–ç¨‹èŒƒå¼ï¼Œæ—¨åœ¨ç®€åŒ–äº‹ä»¶é©±åŠ¨åº”ç”¨çš„å®ç°ã€‚å“åº”å¼ç¼–ç¨‹ä¸“æ³¨äºå¦‚ä½•åˆ›å»ºä¾èµ–äºå˜æ›´çš„æ•°æ®æµå¹¶å¯¹å˜åŒ–åšå‡ºå“åº”ã€‚ IObservable\u0026lt;int\u0026gt; nums = Enumerable.Range(1, 10).ToObservable(); IDisposable subscription = nums.Where(num =\u0026gt; num \u0026gt; 5).Subscribe(Console.WriteLine); subscription.Dispose(); Rx.NET Reactive Extensionsï¼ˆRxï¼‰æ˜¯ä¸€ä¸ªä¸º.NETåº”ç”¨æä¾›å“åº”å¼ç¼–ç¨‹æ¨¡å‹çš„åº“ï¼Œç”¨æ¥æ„å»ºå¼‚æ­¥åŸºäºäº‹ä»¶æµçš„åº”ç”¨ï¼Œé€šè¿‡å®‰è£…System.ReactiveNugetåŒ…è¿›è¡Œå¼•ç”¨ã€‚Rxå°†äº‹ä»¶æµæŠ½è±¡ä¸ºObservable sequencesï¼ˆå¯è§‚å¯Ÿåºåˆ—ï¼‰è¡¨ç¤ºå¼‚æ­¥æ•°æ®æµï¼Œä½¿ç”¨LINQè¿ç®—ç¬¦æŸ¥è¯¢å¼‚æ­¥æ•°æ®æµï¼Œå¹¶ä½¿ç”¨Scheduleræ¥æ§åˆ¶å¼‚æ­¥æ•°æ®æµä¸­çš„å¹¶å‘æ€§ã€‚ç®€å•åœ°è¯´ï¼šRx = Observables + LINQ + Schedulersã€‚\nRx.NETæ ¸å¿ƒï¼š ä¸€åˆ‡çš†ä¸ºæ•°æ®æµ Observableæ˜¯å¯¹æ•°æ®æµçš„æŠ½è±¡ï¼ˆäº‹ä»¶æºï¼‰ Observeræ˜¯å¯¹Observableçš„å“åº”ï¼ˆäº‹ä»¶å¤„ç†ç¨‹åºï¼‰ åœ¨Rxä¸­ï¼Œåˆ†åˆ«ä½¿ç”¨IObservable\u0026lt;T\u0026gt;å’ŒIObserver\u0026lt;T\u0026gt;æ¥å£æ¥è¡¨ç¤ºå¯è§‚å¯Ÿåºåˆ—å’Œè§‚å¯Ÿè€…ã€‚\nIObservable\nï¼ˆå¯ç»§æ‰¿ï¼‰\npublic interface IObservable\u0026lt;out T\u0026gt; { //Notifies the provider that an observer is to receive notifications. IDisposable Subscribe(IObserver\u0026lt;T\u0026gt; observer); } IObserver\nï¼ˆå¯ç»§æ‰¿ï¼‰\npublic interface IObserver\u0026lt;in T\u0026gt; { //Notifies the observer that the provider has finished sending push-based notifications. void OnCompleted(); //Notifies the observer that the provider has experienced an error condition. void OnError(Exception error); //Provides the observer with new data. void OnNext(T value); } åˆ›å»ºIObservableæ–¹å¼ï¼ˆäº‹ä»¶æºï¼‰ï¼š ç›´æ¥å®ç°IObservable\u0026lt;T\u0026gt;æ¥å£ private class MyObservable : IObservable\u0026lt;int\u0026gt; { public IDisposable Subscribe(IObserver\u0026lt;int\u0026gt; observer) { for (int i = 0; i \u0026lt; 100; i++) { observer.OnNext(i); } observer.OnCompleted(); return Disposable.Empty; } } ä½¿ç”¨Observable.Createåˆ›å»º var observable = Observable.Create\u0026lt;int\u0026gt;(observer =\u0026gt; { for (int i = 0; i \u0026lt; 100; i++) { observer.OnNext(i); } observer.OnCompleted(); return Disposable.Empty; }); ä½¿ç”¨Observable.Defferè¿›è¡Œå»¶è¿Ÿåˆ›å»ºï¼ˆå½“æœ‰è§‚å¯Ÿè€…è®¢é˜…æ—¶æ‰åˆ›å»ºï¼‰ Observable.Defer(() =\u0026gt; { var connection = MysqlConnection(user, password); return connection.ToObservable(); }); æ¯”å¦‚è¦è¿æ¥æ•°æ®åº“è¿›è¡ŒæŸ¥è¯¢ï¼Œå¦‚æœæ²¡æœ‰è§‚å¯Ÿè€…ï¼Œé‚£ä¹ˆæ•°æ®åº“è¿æ¥ä¼šä¸€ç›´è¢«å ç”¨ï¼Œè¿™æ ·ä¼šé€ æˆèµ„æºæµªè´¹ã€‚ä½¿ç”¨Defferå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ 4. ä½¿ç”¨Observable.Generateåˆ›å»ºè¿­ä»£ç±»å‹çš„å¯è§‚å¯Ÿåºåˆ—\n// å‚æ•°è¯´æ˜ï¼š // initial state(åˆå§‹å€¼): 0 // condition (false means terminate)(æ¡ä»¶(falseè¡¨ç¤ºç»ˆæ­¢)):i \u0026lt; 10 // next iteration step(ä¸‹ä¸€ä¸ªè¿­ä»£æ­¥éª¤):i+1 // the value in each iteration(æ¯ä¸ªè¿­ä»£ä¸­çš„å€¼):i * 3 // çº¦ç­‰äº: // for (int i = 0; i \u0026lt; 10; i+1) // { // yeild return i * 3; // } IObservable\u0026lt;int\u0026gt; observable = Observable.Generate(0, i =\u0026gt; i \u0026lt; 10, i =\u0026gt; i+1, i =\u0026gt; i * 3); ä½¿ç”¨Observable.Rangeåˆ›å»ºæŒ‡å®šåŒºé—´çš„å¯è§‚å¯Ÿåºåˆ— IObservable\u0026lt;int\u0026gt; observable = Observable.Range (0, 10).Select (i =\u0026gt; i * 2); ç‰¹æ®Šåºåˆ— Observable.Return (\u0026#34;Hello World\u0026#34;);//åˆ›å»ºå•ä¸ªå…ƒç´ çš„å¯è§‚å¯Ÿåºåˆ— Observable.Never\u0026lt;string\u0026gt; ();//åˆ›å»ºä¸€ä¸ªç©ºçš„æ°¸è¿œä¸ä¼šç»“æŸçš„å¯è§‚å¯Ÿåºåˆ— Observable.Throw\u0026lt;ApplicationException\u0026gt; (new ApplicationException (\u0026#34;something bad happened\u0026#34;))//åˆ›å»ºä¸€ä¸ªæŠ›å‡ºæŒ‡å®šå¼‚å¸¸çš„å¯è§‚å¯Ÿåºåˆ— Observable.Empty\u0026lt;string\u0026gt; ()//åˆ›å»ºä¸€ä¸ªç©ºçš„ç«‹å³ç»“æŸçš„å¯è§‚å¯Ÿåºåˆ— ä½¿ç”¨ToObservableè½¬æ¢IEnumerateå’ŒTaskç±»å‹ Enumerable.Range(1, 10).ToObservable(); IObservable\u0026lt;IEnumerable\u0026lt;string\u0026gt;\u0026gt; resultsA = searchEngineA.SearchAsync(term).ToObservable(); ä½¿ç”¨Observable.Usingè¿›è¡Œèµ„æºé‡Šæ”¾ IObservable\u0026lt;string\u0026gt; lines = Observable.Using (() =\u0026gt; // opens the file and returns the stream we work with File.OpenText (\u0026#34;TextFile.txt\u0026#34;), stream =\u0026gt; Observable.Generate ( stream, //initial state s =\u0026gt; !s.EndOfStream, //we continue until we reach the end of the file s =\u0026gt; s, //the stream is our state, it holds the position in the file s =\u0026gt; s.ReadLine ()) //each iteration will emit the current line (and moves to the next) ); ä½¿ç”¨Observable.Intervalåˆ›å»ºæŒ‡å®šé—´éš”å¯è§‚å¯Ÿåºåˆ— Observable.Interval(TimeSpan.FromMilliseconds(1)); ä½¿ç”¨Observable.Timeråˆ›å»ºå¯è§‚å¯Ÿçš„è®¡æ—¶å™¨ Observable.Timer(TimeSpan.FromMilliseconds(2), TimeSpan.FromMilliseconds(1)); å®ç°IObserveræ–¹å¼ï¼ˆäº‹ä»¶å¤„ç†ç¨‹åºï¼‰ï¼š ç»§æ‰¿IObserver // åˆ›å»ºObserver public class MyServer : IObserver\u0026lt;int\u0026gt; { //åºåˆ—å®Œæˆé€šçŸ¥ public void OnCompleted() { Console.WriteLine(\u0026#34;å®Œæˆ\u0026#34;); } //å¼‚å¸¸ public void OnError(Exception error) { Console.WriteLine(error.Message); } //æä¾›æ•°æ®(out) public void OnNext(int value) { Console.WriteLine(value); } } //ä½¿ç”¨Observer subject.Subscribe(new MyServer()); é€šè¿‡Observer.Create()åˆ›å»º // åˆ›å»ºObserver: // Observer.Create\u0026lt;int\u0026gt;(num =\u0026gt; Console.WriteLine(num)) // ä½¿ç”¨Observerï¼š subject.Subscribe(Observer.Create\u0026lt;int\u0026gt;(num =\u0026gt; Console.WriteLine(num))); ç›´æ¥ç”¨Lambdaè¡¨è¾¾å¼è¡¨ç¤ºï¼š subject.Subscribe(num =\u0026gt; Console.WriteLine(num)); Scheduler(æ§åˆ¶å¹¶å‘,ç¨‹åºè°ƒåº¦) Rxæä¾›äº†ä»¥ä¸‹å‡ ç§Schedulerï¼š\nNewThreadSchedulerï¼šå³åœ¨æ–°çº¿ç¨‹ä¸Šæ‰§è¡Œ ThreadPoolSchedulerï¼šå³åœ¨çº¿ç¨‹æ± ä¸­æ‰§è¡Œ TaskPoolSchedulerï¼šä¸ThreadPoolSchedulerç±»ä¼¼ CurrentThreadSchedulerï¼šåœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ ImmediateSchedulerï¼šåœ¨å½“å‰çº¿ç¨‹ç«‹å³æ‰§è¡Œ EventLoopSchedulerï¼šåˆ›å»ºä¸€ä¸ªåå°çº¿ç¨‹æŒ‰åºæ‰§è¡Œæ‰€æœ‰æ“ä½œ ç¤ºä¾‹ï¼š\nObservable.Return(\u0026#34;Hello\u0026#34;,NewThreadScheduler.Default) .Subscribe(str=\u0026gt;Console.WriteLine($\u0026#34;{str} on ThreadIdï¼š{Thread.CurrentThread.ManagedThreadId}\u0026#34;) ); Console.WriteLine($\u0026#34;Current ThreadIdï¼š{Thread.CurrentThread.ManagedThreadId}\u0026#34;); // ä»¥ä¸Šè¾“å‡ºï¼š // Current ThreadIdï¼š1 // Hello on ThreadIdï¼š4 ä¸€èˆ¬è°ƒç”¨æµç¨‹ ç”³æ˜Subject\nåˆ›å»ºæ•°æ®æºObservable\nï¼ˆå¯è§‚å¯Ÿåºåˆ—ï¼‰\nåˆ›å»ºå¤„ç†å‡½æ•°Observerï¼ˆè§‚å¯Ÿè€…ï¼‰å¹¶è®¢é˜…subject\nsubjectè®¢é˜…æ•°æ®æºobservable\n//ç”³æ˜Subjectï¼ˆSubject\u0026lt;T\u0026gt;ï¼‰ï¼Œå€ŸåŠ©Subjectè¿›è¡Œå¤šæ’­ä¼ è¾“,æ³¨æ„ï¼ŒSubjectå†…çš„äº‹ä»¶æ˜¯å¹¶è¡Œåˆ†å‘çš„ //ä¹Ÿå¯ä»¥ä¸ç”¨ä¾é Subjectåˆ†å‘ï¼Œä½†é‚£æ˜¯ä»¥æ–‡æ¡£æµåˆ†å‘,ä¾‹å¦‚é€šè¿‡äº‹ä»¶æºè®¢é˜…ï¼š //observable.Subscribe(i =\u0026gt; Console.WriteLine(i)); Subject\u0026lt;int\u0026gt; subject = new Subject\u0026lt;int\u0026gt;(); //åˆ›å»ºObservable\u0026lt;T\u0026gt;,å¯è§‚å¯Ÿåºåˆ—(æ•°æ®æº) var observable = Observable.Create\u0026lt;int\u0026gt;(observer =\u0026gt; { for (int i = 0; i \u0026lt; 100; i++) { observer.OnNext(i); } observer.OnCompleted(); return Disposable.Empty; }); //å¤„ç†å‡½æ•°ï¼ˆè§‚å¯Ÿè€…ï¼‰è®¢é˜…subject subject.Subscribe(Observer.Create\u0026lt;int\u0026gt;(num =\u0026gt; Console.WriteLine(num))); subject.Subscribe(num =\u0026gt; Console.WriteLine(num)); //æœ€åsubjectè®¢é˜…observable observable.Subscribe(subject); ","permalink":"https://sugarbearr.github.io/posts/rx.net/","summary":"ç¼–ç¨‹èŒƒå¼ï¼š ç¼–ç¨‹èŒƒå¼åˆ†ä¸ºå‘½ä»¤å¼ç¼–ç¨‹ã€å£°æ˜å¼ç¼–ç¨‹ã€å‡½æ•°å¼ç¼–ç¨‹å’Œå“åº”å¼ç¼–ç¨‹ã€‚\nå‘½ä»¤å¼ç¼–ç¨‹ï¼š å‘½ä»¤å¼ç¼–ç¨‹çš„ä¸»è¦æ€æƒ³æ˜¯å…³æ³¨è®¡ç®—æœºæ‰§è¡Œçš„æ­¥éª¤ï¼Œå³ä¸€æ­¥ä¸€æ­¥å‘Šè¯‰è®¡ç®—æœºå…ˆåšä»€ä¹ˆå†åšä»€ä¹ˆã€‚ //1. å£°æ˜å˜é‡ List\u0026lt;int\u0026gt; results = new List\u0026lt;int\u0026gt;(); //2. å¾ªç¯å˜é‡ foreach(var num in Enumerable.Range(1,10)) { //3. æ·»åŠ æ¡ä»¶ if (num \u0026gt; 5) { //4. æ·»åŠ å¤„ç†é€»è¾‘ results.Add(num); Console.WriteLine(num); } } å£°æ˜å¼ç¼–ç¨‹ï¼š å£°æ˜å¼ç¼–ç¨‹æ˜¯ä»¥æ•°æ®ç»“æ„çš„å½¢å¼æ¥è¡¨è¾¾ç¨‹åºæ‰§è¡Œçš„é€»è¾‘ã€‚å®ƒçš„ä¸»è¦æ€æƒ³æ˜¯å‘Šè¯‰è®¡ç®—æœºåº”è¯¥åšä»€ä¹ˆï¼Œä½†ä¸æŒ‡å®šå…·ä½“è¦æ€ä¹ˆåšã€‚ var nums = from num in Enumerable.Range(1,10) where num \u0026gt; 5 select num å‡½æ•°å¼ç¼–ç¨‹ï¼š ä¸»è¦æ€æƒ³æ˜¯æŠŠè¿ç®—è¿‡ç¨‹å°½é‡å†™æˆä¸€ç³»åˆ—åµŒå¥—çš„å‡½æ•°è°ƒç”¨ã€‚ Enumerable.Range(1, 10).Where(num =\u0026gt; num \u0026gt; 5).ToList().ForEach(Console.WriteLine); å“åº”å¼ç¼–ç¨‹ï¼š å“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ç§é¢å‘æ•°æ®æµå’Œå˜åŒ–ä¼ æ’­çš„ç¼–ç¨‹èŒƒå¼ï¼Œæ—¨åœ¨ç®€åŒ–äº‹ä»¶é©±åŠ¨åº”ç”¨çš„å®ç°ã€‚å“åº”å¼ç¼–ç¨‹ä¸“æ³¨äºå¦‚ä½•åˆ›å»ºä¾èµ–äºå˜æ›´çš„æ•°æ®æµå¹¶å¯¹å˜åŒ–åšå‡ºå“åº”ã€‚ IObservable\u0026lt;int\u0026gt; nums = Enumerable.Range(1, 10).ToObservable(); IDisposable subscription = nums.Where(num =\u0026gt; num \u0026gt; 5).Subscribe(Console.WriteLine); subscription.Dispose(); Rx.","title":"Rx.NET"}]